var _e=Object.defineProperty;var ye=(f,o,r)=>o in f?_e(f,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):f[o]=r;var b=(f,o,r)=>(ye(f,typeof o!="symbol"?o+"":o,r),r);import{E as we,R as xe,m as Ce,p as Se,q as Me,s as Ee,v as Te,x as Le,y as Ve,z as ke,A as Re,B as Ne,C as Ie,D as He,G as Pe,H as Be,r as M,I as je,J as Oe,K as Fe,L as Ue,M as $e,N as Ae,O as qe,P as De,u as D,Q as ze,S as We,n as Xe,T as Ke,U as Ge,t as A,V as Je,W as Qe,X as Ye,F as ce,Y as Ze,Z as et,_ as tt,$ as at,a0 as st,a1 as nt,a2 as ot,a3 as it,a4 as rt,c as lt,a5 as dt,g as ct,a as z,b as l,a6 as ut,a7 as mt,a8 as pt,a9 as ft,aa as ht,l as ue,e as me,ab as vt,d as pe,ac as gt,ad as bt,ae as _t,af as yt,ag as wt,ah as xt,ai as Ct,aj as St,ak as Mt,al as Et,am as Tt,an as Lt,ao as Vt,ap as kt,aq as Rt,ar as Nt,as as It,at as Ht,au as Pt,av as Bt,aw as jt,ax as Ot,ay as Ft,o as Ut,az as $t,aA as At,aB as qt,aC as fe,aD as Dt,k as W,aE as zt,aF as Wt,aG as Xt,aH as Kt,aI as Gt,f as he,aJ as Jt,j as Qt,aK as Yt,aL as Zt,aM as ea,aN as ta,aO as aa,aP as sa,aQ as na,aR as oa,aS as ia,aT as ra,aU as la,aV as da,aW as ca,aX as ua,aY as ma,aZ as pa,a_ as fa,w as ha,a$ as va,b0 as ga,b1 as ba,b2 as _a,b3 as ya,b4 as wa,b5 as ve,b6 as xa,b7 as Ca,b8 as Sa,b9 as Ma,ba as Ea,bb as Ta,bc as La,bd as Va,be as ka,bf as Ra,bg as Na,bh as Ia,bi as Ha,bj as Pa,bk as Ba,bl as ja,bm as Oa,bn as Fa,bo as ge,bp as Ua,bq as $a,br as Aa,i as le,h as qa,bs as Da}from"./index.1706283505831.js";import{E as O,_ as za}from"./eventType.1706283505831.js";const Wa=()=>{},Xa=Object.freeze(Object.defineProperty({__proto__:null,compile:Wa,EffectScope:we,ReactiveEffect:xe,customRef:Ce,effect:Se,effectScope:Me,getCurrentScope:Ee,isProxy:Te,isReactive:Le,isReadonly:Ve,isRef:ke,isShallow:Re,markRaw:Ne,onScopeDispose:Ie,proxyRefs:He,reactive:Pe,readonly:Be,ref:M,shallowReactive:je,shallowReadonly:Oe,shallowRef:Fe,stop:Ue,toRaw:$e,toRef:Ae,toRefs:qe,triggerRef:De,unref:D,camelize:ze,capitalize:We,normalizeClass:Xe,normalizeProps:Ke,normalizeStyle:Ge,toDisplayString:A,toHandlerKey:Je,BaseTransition:Qe,Comment:Ye,Fragment:ce,KeepAlive:Ze,Static:et,Suspense:tt,Teleport:at,Text:st,callWithAsyncErrorHandling:nt,callWithErrorHandling:ot,cloneVNode:it,compatUtils:rt,computed:lt,createBlock:dt,createCommentVNode:ct,createElementBlock:z,createElementVNode:l,createHydrationRenderer:ut,createPropsRestProxy:mt,createRenderer:pt,createSlots:ft,createStaticVNode:ht,createTextVNode:ue,createVNode:me,defineAsyncComponent:vt,defineComponent:pe,defineEmits:gt,defineExpose:bt,defineProps:_t,get devtools(){return yt},getCurrentInstance:wt,getTransitionRawChildren:xt,guardReactiveProps:Ct,h:St,handleError:Mt,initCustomFormatter:Et,inject:Tt,isMemoSame:Lt,isRuntimeOnly:Vt,isVNode:kt,mergeDefaults:Rt,mergeProps:Nt,nextTick:It,onActivated:Ht,onBeforeMount:Pt,onBeforeUnmount:Bt,onBeforeUpdate:jt,onDeactivated:Ot,onErrorCaptured:Ft,onMounted:Ut,onRenderTracked:$t,onRenderTriggered:At,onServerPrefetch:qt,onUnmounted:fe,onUpdated:Dt,openBlock:W,popScopeId:zt,provide:Wt,pushScopeId:Xt,queuePostFlushCb:Kt,registerRuntimeCompiler:Gt,renderList:he,renderSlot:Jt,resolveComponent:Qt,resolveDirective:Yt,resolveDynamicComponent:Zt,resolveFilter:ea,resolveTransitionHooks:ta,setBlockTracking:aa,setDevtoolsHook:sa,setTransitionHooks:na,ssrContextKey:oa,ssrUtils:ia,toHandlers:ra,transformVNodeArgs:la,useAttrs:da,useSSRContext:ca,useSlots:ua,useTransitionState:ma,version:pa,warn:fa,watch:ha,watchEffect:va,watchPostEffect:ga,watchSyncEffect:ba,withAsyncContext:_a,withCtx:ya,withDefaults:wa,withDirectives:ve,withMemo:xa,withScopeId:Ca,Transition:Sa,TransitionGroup:Ma,VueElement:Ea,createApp:Ta,createSSRApp:La,defineCustomElement:Va,defineSSRCustomElement:ka,hydrate:Ra,initDirectivesForSSR:Na,render:Ia,useCssModule:Ha,useCssVars:Pa,vModelCheckbox:Ba,vModelDynamic:ja,vModelRadio:Oa,vModelSelect:Fa,vModelText:ge,vShow:Ua,withKeys:$a,withModifiers:Aa},Symbol.toStringTag,{value:"Module"}));class de{constructor(o,r,p,c,i){b(this,"remoteUser","");b(this,"role","");b(this,"peerConnection");b(this,"iceconfig");b(this,"isOntrack",!1);b(this,"isOffer",!1);b(this,"isLoading");b(this,"remoteVideoHTMLVideoElement");b(this,"remoteVideoHTMLCanvasElement");b(this,"remoteWrap",document.createElement("div"));b(this,"VideoWraps",document.getElementById("RemoteVideos"));b(this,"mediaStream",new MediaStream);b(this,"mediaStreamId","");this.remoteUser=o,this.role=i,this.iceconfig=r,this.isLoading=c,p?this.useHtmlCanvasElement():this.useHtmlVideoElement(),this.init()}init(){const o={iceServers:this.iceconfig.iceServers};this.peerConnection=new RTCPeerConnection(o),this.peerConnection.ontrack=r=>{var p,c;this.mediaStreamId!=r.streams[0].id&&(this.mediaStreamId=r.streams[0].id,this.mediaStream.getTracks()&&this.mediaStream.getTracks().forEach(i=>{this.mediaStream.removeTrack(i)})),this.mediaStream.addTrack(r.track),this.isOntrack=!0,(p=this.remoteVideoHTMLVideoElement)==null||p.play(),this.isLoading.value=!1,(c=this.VideoWraps)==null||c.appendChild(this.remoteWrap)}}useHtmlVideoElement(){this.remoteVideoHTMLVideoElement=document.createElement("video"),this.remoteVideoHTMLVideoElement.srcObject=this.mediaStream,this.remoteVideoHTMLVideoElement.width=500,this.remoteVideoHTMLVideoElement.height=500,this.remoteVideoHTMLVideoElement.id=this.remoteUser;const o=document.createElement("p");o.textContent=this.remoteUser,o.classList.add("text-white","text-sm","text-center"),this.remoteWrap.classList.add("m-4","relative","border-8","border-slate-400","rounded-md"),this.remoteVideoHTMLVideoElement.autoplay=!0,this.remoteWrap.appendChild(this.remoteVideoHTMLVideoElement),this.remoteWrap.appendChild(o)}useHtmlCanvasElement(){this.remoteVideoHTMLVideoElement=document.createElement("video"),this.remoteVideoHTMLVideoElement.srcObject=this.mediaStream,this.remoteVideoHTMLVideoElement.id=this.remoteUser,this.remoteVideoHTMLVideoElement.autoplay=!0,this.remoteVideoHTMLCanvasElement=document.createElement("canvas"),this.remoteVideoHTMLCanvasElement.width=500,this.remoteVideoHTMLCanvasElement.height=500,this.remoteVideoHTMLCanvasElement.id=this.remoteUser;const o=document.createElement("p");o.textContent=this.remoteUser,o.classList.add("text-white","text-sm","text-center"),this.remoteWrap.classList.add("relative","m-4","border-8","border-slate-400","rounded-md"),this.remoteWrap.appendChild(this.remoteVideoHTMLCanvasElement),this.remoteWrap.appendChild(o);let r=this.remoteVideoHTMLCanvasElement.getContext("2d");const p=this;p.remoteVideoHTMLVideoElement&&(p.remoteVideoHTMLVideoElement.onplay=()=>{var c=this.remoteVideoHTMLVideoElement;(function i(){!c.paused&&!c.ended&&(p.remoteVideoHTMLCanvasElement&&(p.remoteVideoHTMLCanvasElement.width=p.remoteVideoHTMLVideoElement.videoWidth,p.remoteVideoHTMLCanvasElement.height=p.remoteVideoHTMLVideoElement.videoHeight),r.drawImage(c,0,0),setTimeout(i,1e3/60))})()})}close(){var o,r;(o=this.peerConnection)==null||o.close(),this.isOntrack&&((r=this.VideoWraps)==null||r.removeChild(this.remoteWrap))}}var Ka=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ga(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}function Ja(f){var o=f.default;if(typeof o=="function"){var r=function(){return o.apply(this,arguments)};r.prototype=o.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(f).forEach(function(p){var c=Object.getOwnPropertyDescriptor(f,p);Object.defineProperty(r,p,c.get?c:{enumerable:!0,get:function(){return f[p]}})}),r}var be={exports:{}};const Qa=Ja(Xa);(function(f,o){(function(p,c){f.exports=c(Qa)})(Ka,r=>(()=>{var p={657:(s,h)=>{Object.defineProperty(h,"__esModule",{value:!0}),h.default=(v,w)=>{const L=v.__vccOpts||v;for(const[E,T]of w)L[E]=T;return L}},976:s=>{s.exports=r}},c={};function i(s){var h=c[s];if(h!==void 0)return h.exports;var v=c[s]={exports:{}};return p[s](v,v.exports,i),v.exports}i.d=(s,h)=>{for(var v in h)i.o(h,v)&&!i.o(s,v)&&Object.defineProperty(s,v,{enumerable:!0,get:h[v]})},i.o=(s,h)=>Object.prototype.hasOwnProperty.call(s,h),i.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})};var y={};return(()=>{i.r(y),i.d(y,{Component:()=>u,LoadingPlugin:()=>ne,default:()=>q,useLoading:()=>B});var s=i(976);function h(t){var m;typeof t.remove<"u"?t.remove():(m=t.parentNode)==null||m.removeChild(t)}function v(t,m,C){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const S=(0,s.h)(t,m,_),g=document.createElement("div");return g.classList.add("vld-container"),C.appendChild(g),(0,s.render)(S,g),S.component}function w(){return typeof window<"u"}const L=w()?window.HTMLElement:Object,E=["aria-busy"],T={class:"vl-icon"};function I(t,m,C,_,S,g){return(0,s.openBlock)(),(0,s.createBlock)(s.Transition,{name:t.transition},{default:(0,s.withCtx)(()=>[(0,s.withDirectives)((0,s.createElementVNode)("div",{tabindex:"0",class:(0,s.normalizeClass)(["vl-overlay vl-active",{"vl-full-page":t.isFullPage}]),"aria-busy":t.isActive,"aria-label":"Loading",style:(0,s.normalizeStyle)({zIndex:t.zIndex})},[(0,s.createElementVNode)("div",{class:"vl-background",onClick:m[0]||(m[0]=(0,s.withModifiers)(function(){return t.cancel&&t.cancel(...arguments)},["prevent"])),style:(0,s.normalizeStyle)(t.bgStyle)},null,4),(0,s.createElementVNode)("div",T,[(0,s.renderSlot)(t.$slots,"before"),(0,s.renderSlot)(t.$slots,"default",{},()=>[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(t.loader),{color:t.color,width:t.width,height:t.height},null,8,["color","width","height"]))]),(0,s.renderSlot)(t.$slots,"after")])],14,E),[[s.vShow,t.isActive]])]),_:3},8,["name"])}const F={mounted(){this.enforceFocus&&document.addEventListener("focusin",this.focusIn)},methods:{focusIn(t){if(!this.isActive||t.target===this.$el||this.$el.contains(t.target))return;let m=this.container?this.container:this.isFullPage?null:this.$el.parentElement;(this.isFullPage||m&&m.contains(t.target))&&(t.preventDefault(),this.$el.focus())}},beforeUnmount(){document.removeEventListener("focusin",this.focusIn)}},H=["width","height","stroke"],X=[(0,s.createStaticVNode)('<g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" stroke-width="2"><circle stroke-opacity=".25" cx="18" cy="18" r="18"></circle><path d="M36 18c0-9.94-8.06-18-18-18"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="0.8s" repeatCount="indefinite"></animateTransform></path></g></g>',1)];function K(t,m,C,_,S,g){return(0,s.openBlock)(),(0,s.createElementBlock)("svg",{viewBox:"0 0 38 38",xmlns:"http://www.w3.org/2000/svg",width:t.width,height:t.height,stroke:t.color},X,8,H)}const G=(0,s.defineComponent)({name:"spinner",props:{color:{type:String,default:"#000"},height:{type:Number,default:64},width:{type:Number,default:64}}});var P=i(657);const J=(0,P.default)(G,[["render",K]]),Q=["fill","width","height"],U=[(0,s.createStaticVNode)('<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity="0.3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="0.5" to="0.5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',3)];function Z(t,m,C,_,S,g){return(0,s.openBlock)(),(0,s.createElementBlock)("svg",{viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",fill:t.color,width:t.width,height:t.height},U,8,Q)}const ee=(0,s.defineComponent)({name:"dots",props:{color:{type:String,default:"#000"},height:{type:Number,default:240},width:{type:Number,default:60}}}),te=(0,P.default)(ee,[["render",Z]]),ae=["height","width","fill"],se=[(0,s.createStaticVNode)('<rect x="0" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0s" dur="0.6s" repeatCount="indefinite"></animate><animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0s" dur="0.6s" repeatCount="indefinite"></animate></rect><rect x="10" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0.15s" dur="0.6s" repeatCount="indefinite"></animate><animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0.15s" dur="0.6s" repeatCount="indefinite"></animate></rect><rect x="20" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0.3s" dur="0.6s" repeatCount="indefinite"></animate><animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0.3s" dur="0.6s" repeatCount="indefinite"></animate></rect>',3)];function e(t,m,C,_,S,g){return(0,s.openBlock)(),(0,s.createElementBlock)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",height:t.height,width:t.width,fill:t.color},se,8,ae)}const a=(0,s.defineComponent)({name:"bars",props:{color:{type:String,default:"#000"},height:{type:Number,default:40},width:{type:Number,default:40}}}),x={Spinner:J,Dots:te,Bars:(0,P.default)(a,[["render",e]])},k=(0,s.defineComponent)({name:"VueLoading",mixins:[F],props:{active:Boolean,programmatic:Boolean,container:[Object,Function,L],isFullPage:{type:Boolean,default:!0},enforceFocus:{type:Boolean,default:!0},lockScroll:Boolean,transition:{type:String,default:"fade"},canCancel:Boolean,onCancel:{type:Function,default:()=>{}},color:String,backgroundColor:String,opacity:Number,width:Number,height:Number,zIndex:Number,loader:{type:String,default:"spinner"}},components:x,emits:["hide","update:active"],data(){return{isActive:this.active}},mounted(){document.addEventListener("keyup",this.keyPress)},methods:{cancel(){!this.canCancel||!this.isActive||(this.hide(),this.onCancel.apply(null,arguments))},hide(){this.$emit("hide"),this.$emit("update:active",!1),this.programmatic&&(this.isActive=!1,setTimeout(()=>{const t=this.$el.parentElement;(0,s.render)(null,t),h(t)},150))},disableScroll(){this.isFullPage&&this.lockScroll&&document.body.classList.add("vl-shown")},enableScroll(){this.isFullPage&&this.lockScroll&&document.body.classList.remove("vl-shown")},keyPress(t){t.keyCode===27&&this.cancel()}},watch:{active(t){this.isActive=t},isActive(t){t?this.disableScroll():this.enableScroll()}},computed:{bgStyle(){return{background:this.backgroundColor,opacity:this.opacity}}},beforeUnmount(){document.removeEventListener("keyup",this.keyPress)}}),u=(0,P.default)(k,[["render",I]]);function B(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return{show(){let C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t,_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:m;const g={...t,...C,...{programmatic:!0,lockScroll:!0,isFullPage:!1,active:!0}};let N=g.container;g.container||(N=document.body,g.isFullPage=!0);const $={...m,..._};return{hide:v(u,g,N,$).ctx.hide}}}}const ne=function(t){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const _=B(m,C);t.config.globalProperties.$loading=_,t.provide("$loading",_)},q=u})(),y})())})(be);const Ya=Ga(be.exports);const Za={class:"bg-gradient-to-b from-gray-400 via-gray-800 to-black w-full min-h-screen"},es={class:"bg-gradient-to-t from-blue-200 to-gray-800 opacity-90 fixed w-full z-40 border-b-2 border-platinum h-header"},ts={class:"flex p-3 max-w-8xl m-auto h-header"},as={class:"max-w-one-three w-full flex md:flex-column text-center items-center"},ss={class:"flex w-full justify-start items-center"},ns=l("img",{src:za,class:"max-w-one-three"},null,-1),os={class:"text-zinc-100 px-1 text-xs sm:text-base max-w-one-three sm:max-w-one-two truncate md:max-w-full"},is=["src"],rs={class:"max-w-one-three w-full flex justify-center items-center"},ls={class:"text-xs sm:text-base text-zinc-100 p-2 truncate"},ds={class:"box-border pt-20 max-w-8xl m-auto px-3 text-2xl min-h-screen flex"},cs={class:"text-2xl mx-auto w-full"},us=l("div",{id:"LocalVideo",class:"z-50 absolute top-0 left-0 md:w-250 md:h-250 w-100 h-100"},null,-1),ms={id:"RemoteVideos",class:"flex justify-center flex-row max-h-screen-5rem flex-wrap"},ps={id:"MessageWrap",class:"absolute z-50 left-0 bottom-0 w-full flex justify-start"},fs={class:"rounded-md max-w-one-two bg-slate-600 p-3"},hs={id:"Message",class:"flex flex-col text-sm text-yellow-900"},vs={class:"my-1 rounded-md inline bg-white p-2"},gs=l("div",{class:"bg-slate-400 h-1 my-2"},null,-1),bs={class:"flex justify-center"},xs=pe({__name:"Room",setup(f){const o=qa(),r={IceServerList:X,Offer:K,Answer:G,Candidate:P,NewUser:oe,UserLeaveFromRoom:Q,BroadcastMessage:J};Object.entries(r).forEach(([e,a])=>{var n;(n=o.state.socketInstance)==null||n.subscribe(e,a)}),o.state.roomIsSubscribe=!0;const p={audio:!0,video:{width:{ideal:1280},height:{ideal:720}}},c=o.state.socketInstance,i=new Map,y=Da(),s=M(),h=o.state.user,v=M(!0),w=M(),L=M(!1),E=M(),T=M(),I=M(!1),F=M("/src/assets/play_arrow.svg"),H=M(),V=M([]);if(c){const e={Type:O.getIceServerlist,Data:{RoomId:y.query.room}};c.wsSend(e)}else le.push({name:"Lobby"});function X(e){w.value=e}async function K(e){for(;w.value==null;)await new Promise(a=>setTimeout(a,16));if(i.has(e.ReqId))i.has(e.ReqId)&&await Y(i.get(e.ReqId),e);else{const a=new de(e.ReqId,w.value,o.state.useFirefoxAndNvidia,L);i.set(e.ReqId,a),await Y(a,e)}}async function G(e){for(;w.value==null;)await new Promise(a=>setTimeout(a,16));i.has(e.ReqId)&&await Z(i.get(e.ReqId),e)}async function P(e){var n;for(;w.value==null;)await new Promise(d=>setTimeout(d,16));const a=i.get(e.ReqId);(n=a==null?void 0:a.peerConnection)==null||n.addIceCandidate({sdpMid:e.SdpMid,sdpMLineIndex:e.SdpMLineIndex,candidate:e.Candidate})}async function oe(e){for(s.value=e;w.value==null;)await new Promise(a=>setTimeout(a,16));!i.has(e.NewUser)&&I.value&&await U(e.NewUser)}function J(e){V.value.push({MessageSender:e.MessageSender,Message:e.Message}),V.value.length>=10&&V.value.splice(0,1)}function Q(e){i.has(e.LeaveUser)&&te(i.get(e.LeaveUser),e)}async function Y(e,a){var x,k,R;e.peerConnection.onicecandidate=u=>{if(!u.candidate||!u.candidate.candidate)return;const B={Type:O.sendCandidate,Data:{RoomId:y.query.room,SdpMid:u.candidate.sdpMid||"0",SdpMLineIndex:u.candidate.sdpMLineIndex,RecvId:a.ReqId,Candidate:u.candidate.candidate}};c.wsSend(B)},await((x=e.peerConnection)==null?void 0:x.setRemoteDescription(new RTCSessionDescription({sdp:a.Desc.Sdp,type:a.Desc.Type})));let n=await((k=e.peerConnection)==null?void 0:k.createAnswer());(n==null?void 0:n.sdp)&&o.state.useFirefoxAndNvidia&&!v.value&&(n.sdp=re(n.sdp,"H264")),await((R=e.peerConnection)==null?void 0:R.setLocalDescription(n));const d={Type:O.answer,Data:{RoomId:y.query.room,RecvId:a.ReqId,Desc:n}};c.wsSend(d)}async function U(e){var a;if(!i.has(e)){const n=new de(e,w.value,o.state.useFirefoxAndNvidia,L);i.set(e,n)}if(i.has(e)){const n=i.get(e);if(((a=n.peerConnection)==null?void 0:a.signalingState)=="have-remote-offer")return;n.peerConnection.onicecandidate=d=>{if(!d.candidate||!d.candidate.candidate)return;const x={Type:O.sendCandidate,Data:{RoomId:y.query.room,SdpMid:d.candidate.sdpMid||"0",SdpMLineIndex:d.candidate.sdpMLineIndex,RecvId:n.remoteUser,Candidate:d.candidate.candidate}};c.wsSend(x)},n.peerConnection.onnegotiationneeded=async function(){const d=await n.peerConnection.createOffer();n.isOffer=!0,await n.peerConnection.setLocalDescription(d);const x={Type:O.offer,Data:{RoomId:y.query.room,RecvId:i.get(e).remoteUser,Desc:d}};c.wsSend(x)},E.value.getTracks().forEach(d=>{n.peerConnection.addTrack(d,E.value)})}}async function Z(e,a){var d;const n={sdp:a.Desc.Sdp,type:a.Desc.Type};(d=e.peerConnection)==null||d.setRemoteDescription(n)}async function ee(){return navigator.mediaDevices.getUserMedia(p).then(e=>{E.value=e,T.value=document.createElement("video"),T.value.srcObject=E.value,T.value.classList.add("rounded-full","aspect-square","border-8","bg-black","border-slate-600"),T.value.autoplay=!0;const a=document.getElementById("LocalVideo");a==null||a.appendChild(T.value)}).catch(e=>{alert("Browser doesn't support or there is some errors."+e)})}async function ie(){var e;if(I.value=!I.value,I.value?F.value="/src/assets/close.svg":F.value="/src/assets/play_arrow.svg",I.value)await ee(),s.value!=null?s.value.UserList.forEach(async a=>{a!=h.id&&await U(a)}):o.state.Room.UserList.forEach(async a=>{a!=h.id&&await U(a)});else{(e=E.value)==null||e.getTracks().forEach(n=>{n.stop()});const a=document.getElementById("LocalVideo");a==null||a.removeChild(T.value)}}function te(e,a){e.close(),i.delete(a.LeaveUser)}function ae(){const e={Type:O.broadcastMessage,Data:{RoomId:y.query.room,Message:H.value}};c.wsSend(e),V.value.push({MessageSender:"me",Message:H.value}),V.value.length>=10&&V.value.splice(0,1),H.value=""}function re(e,a){var n=function(d){var x=new RegExp("(a=rtpmap:(\\d*) "+a+"/90000\\r\\n)"),k=d.match(x);if(k==null||k.length<=2)return d;var R=k[2],u=d.replace(x,""),B=new RegExp("(a=rtcp-fb:"+R+`.*\r
)`,"g");u=u.replace(B,"");var ne=new RegExp("(a=fmtp:"+R+`.*\r
)`,"g");u=u.replace(ne,"");var q=new RegExp("(a=fmtp:(\\d*) apt="+R+"\\r\\n)"),t=u.match(q),m="";if(t!=null&&t.length>=3){m=t[2],u=u.replace(q,"");var C=new RegExp("(a=rtpmap:"+m+`.*\r
)`,"g");u=u.replace(C,"")}var _=/(m=video.*\r\n)/,S=u.match(_);if(S!=null){for(var g=S[0].substring(0,S[0].length-2),N=g.split(" "),$=N[0],j=1;j<N.length;j++)N[j]==R||N[j]==m||($+=" "+N[j]);$+=`\r
`,u=u.replace(_,$)}return n(u)};return n(e)}function se(){le.push({name:"Lobby"})}return fe(()=>{var e;Object.entries(r).forEach(([a,n])=>{var d;(d=o.state.socketInstance)==null||d.unSubscribe(a,n)}),i.forEach(a=>{a.close()}),(e=E.value)==null||e.getTracks().forEach(a=>{a.stop()}),i.clear()}),(e,a)=>(W(),z("div",Za,[l("div",es,[l("header",ts,[l("div",as,[l("div",ss,[ns,l("p",os,A(D(h).id),1),l("button",{onClick:ie,class:"bg-red-500 max-w-one-three hover:bg-red-700 focus:outline-none focus:ring focus:ring-red-300 sm:text-sm active:bg-red-700 p-2 rounded-full"},[l("img",{src:F.value,class:"cursor-pointer",alt:"userImage"},null,8,is)])])]),l("div",rs,[l("div",null,[l("p",ls," Room:"+A(D(y).query.room),1)])]),l("div",{class:"max-w-one-three w-full flex justify-end items-center"},[l("button",{onClick:se,class:"bg-sky-500 hover:bg-sky-700 focus:outline-none focus:ring focus:ring-sky-300 active:bg-sky-700 px-5 py-2 text-xs leading-5 sm:text-base rounded-full font-semibold text-white"}," Home ")])])]),l("div",ds,[l("div",cs,[us,l("div",ms,[me(D(Ya),{active:L.value,"onUpdate:active":a[0]||(a[0]=n=>L.value=n),"can-cancel":!1,"is-full-page":!1},null,8,["active"])]),l("div",ps,[l("div",fs,[l("div",hs,[(W(!0),z(ce,null,he(V.value,n=>(W(),z("div",vs,[l("p",null,[l("span",null,A(n.MessageSender)+": ",1),ue(A(n.Message),1)])]))),256))]),gs,l("div",bs,[ve(l("input",{class:"max-w-one-two md:max-w-full rounded-full text-base px-2 my-1 mx-1","onUpdate:modelValue":a[1]||(a[1]=n=>H.value=n)},null,512),[[ge,H.value]]),l("button",{onClick:ae,class:"bg-gray-500 hover:bg-gray-700 focus:outline-none focus:ring focus:ring-gray-300 active:bg-gray-700 px-3 py-2 leading-5 text-sm rounded-full font-semibold text-white"}," Send ")])])])])])]))}});export{xs as default};
