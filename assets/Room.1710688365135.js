var _e=Object.defineProperty;var ye=(f,n,r)=>n in f?_e(f,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):f[n]=r;var y=(f,n,r)=>(ye(f,typeof n!="symbol"?n+"":n,r),r);import{E as we,R as xe,l as Ce,m as Se,p as Me,q as Ee,s as Te,v as Le,w as Ve,x as ke,y as Re,z as He,A as Ie,B as Ne,C as Pe,D as Be,r as E,G as je,H as Fe,I as Oe,J as Ue,K as $e,L as Ae,M as De,N as qe,u as B,O as ze,P as We,n as Xe,Q as Ke,S as Ge,t as j,T as Je,U as Qe,V as Ye,F as se,W as Ze,X as et,Y as tt,Z as at,_ as st,$ as ot,a0 as nt,a1 as it,a2 as rt,a3 as lt,a4 as ct,f as dt,c as F,a as l,a5 as ut,a6 as mt,a7 as pt,a8 as ft,a9 as ht,k as ue,b as me,aa as vt,d as pe,ab as gt,ac as bt,ad as _t,ae as yt,af as wt,ag as xt,ah as Ct,ai as St,aj as Mt,ak as Et,al as Tt,am as Lt,an as Vt,ao as kt,ap as Rt,aq as Ht,ar as It,as as Nt,at as Pt,au as Bt,av as jt,aw as Ft,ax as Ot,o as Ut,ay as $t,az as At,aA as Dt,aB as fe,aC as qt,j as O,aD as zt,aE as Wt,aF as Xt,aG as Kt,aH as Gt,e as oe,aI as Jt,i as Qt,aJ as Yt,aK as Zt,aL as ea,aM as ta,aN as aa,aO as sa,aP as oa,aQ as na,aR as ia,aS as ra,aT as la,aU as ca,aV as da,aW as ua,aX as ma,aY as pa,aZ as fa,a_ as ha,a$ as va,b0 as ga,b1 as ba,b2 as _a,b3 as ya,b4 as wa,b5 as he,b6 as xa,b7 as Ca,b8 as Sa,b9 as Ma,ba as Ea,bb as Ta,bc as La,bd as Va,be as ka,bf as Ra,bg as Ha,bh as Ia,bi as Na,bj as Pa,bk as Ba,bl as ja,bm as Fa,bn as Oa,bo as ve,bp as Ua,bq as $a,br as Aa,h as le,g as Da,bs as qa}from"./index.1710688365135.js";import{E as P,_ as za}from"./eventType.1710688365135.js";const Wa=()=>{},Xa=Object.freeze(Object.defineProperty({__proto__:null,compile:Wa,EffectScope:we,ReactiveEffect:xe,customRef:Ce,effect:Se,effectScope:Me,getCurrentScope:Ee,isProxy:Te,isReactive:Le,isReadonly:Ve,isRef:ke,isShallow:Re,markRaw:He,onScopeDispose:Ie,proxyRefs:Ne,reactive:Pe,readonly:Be,ref:E,shallowReactive:je,shallowReadonly:Fe,shallowRef:Oe,stop:Ue,toRaw:$e,toRef:Ae,toRefs:De,triggerRef:qe,unref:B,camelize:ze,capitalize:We,normalizeClass:Xe,normalizeProps:Ke,normalizeStyle:Ge,toDisplayString:j,toHandlerKey:Je,BaseTransition:Qe,Comment:Ye,Fragment:se,KeepAlive:Ze,Static:et,Suspense:tt,Teleport:at,Text:st,callWithAsyncErrorHandling:ot,callWithErrorHandling:nt,cloneVNode:it,compatUtils:rt,computed:lt,createBlock:ct,createCommentVNode:dt,createElementBlock:F,createElementVNode:l,createHydrationRenderer:ut,createPropsRestProxy:mt,createRenderer:pt,createSlots:ft,createStaticVNode:ht,createTextVNode:ue,createVNode:me,defineAsyncComponent:vt,defineComponent:pe,defineEmits:gt,defineExpose:bt,defineProps:_t,get devtools(){return yt},getCurrentInstance:wt,getTransitionRawChildren:xt,guardReactiveProps:Ct,h:St,handleError:Mt,initCustomFormatter:Et,inject:Tt,isMemoSame:Lt,isRuntimeOnly:Vt,isVNode:kt,mergeDefaults:Rt,mergeProps:Ht,nextTick:It,onActivated:Nt,onBeforeMount:Pt,onBeforeUnmount:Bt,onBeforeUpdate:jt,onDeactivated:Ft,onErrorCaptured:Ot,onMounted:Ut,onRenderTracked:$t,onRenderTriggered:At,onServerPrefetch:Dt,onUnmounted:fe,onUpdated:qt,openBlock:O,popScopeId:zt,provide:Wt,pushScopeId:Xt,queuePostFlushCb:Kt,registerRuntimeCompiler:Gt,renderList:oe,renderSlot:Jt,resolveComponent:Qt,resolveDirective:Yt,resolveDynamicComponent:Zt,resolveFilter:ea,resolveTransitionHooks:ta,setBlockTracking:aa,setDevtoolsHook:sa,setTransitionHooks:oa,ssrContextKey:na,ssrUtils:ia,toHandlers:ra,transformVNodeArgs:la,useAttrs:ca,useSSRContext:da,useSlots:ua,useTransitionState:ma,version:pa,warn:fa,watch:ha,watchEffect:va,watchPostEffect:ga,watchSyncEffect:ba,withAsyncContext:_a,withCtx:ya,withDefaults:wa,withDirectives:he,withMemo:xa,withScopeId:Ca,Transition:Sa,TransitionGroup:Ma,VueElement:Ea,createApp:Ta,createSSRApp:La,defineCustomElement:Va,defineSSRCustomElement:ka,hydrate:Ra,initDirectivesForSSR:Ha,render:Ia,useCssModule:Na,useCssVars:Pa,vModelCheckbox:Ba,vModelDynamic:ja,vModelRadio:Fa,vModelSelect:Oa,vModelText:ve,vShow:Ua,withKeys:$a,withModifiers:Aa},Symbol.toStringTag,{value:"Module"}));class ce{constructor(n,r,h,u,i){y(this,"remoteUser","");y(this,"role","");y(this,"peerConnection");y(this,"iceconfig");y(this,"isOntrack",!1);y(this,"isOffer",!1);y(this,"isLoading");y(this,"remoteVideoHTMLVideoElement");y(this,"remoteVideoHTMLCanvasElement");y(this,"remoteWrap");y(this,"mediaStream",new MediaStream);y(this,"mediaStreamId","");this.remoteUser=n,this.role=i,this.iceconfig=r,this.isLoading=u,h?this.useHtmlCanvasElement():this.useHtmlVideoElement(),this.init()}init(){const n={iceServers:this.iceconfig.iceServers};this.peerConnection=new RTCPeerConnection(n),this.peerConnection.ontrack=r=>{var h,u;this.mediaStreamId!=r.streams[0].id&&(this.remoteWrap=(h=document.getElementById(this.remoteUser))!=null?h:void 0,this.remoteWrap&&this.remoteVideoHTMLVideoElement?this.remoteWrap.appendChild(this.remoteVideoHTMLVideoElement):this.remoteWrap&&this.remoteVideoHTMLCanvasElement&&this.remoteWrap.appendChild(this.remoteVideoHTMLCanvasElement),this.mediaStreamId=r.streams[0].id,this.mediaStream.getTracks()&&this.mediaStream.getTracks().forEach(i=>{this.mediaStream.removeTrack(i)})),this.mediaStream.addTrack(r.track),this.isOntrack=!0,(u=this.remoteVideoHTMLVideoElement)==null||u.play(),this.isLoading.value=!1}}useHtmlVideoElement(){this.remoteVideoHTMLVideoElement=document.createElement("video"),this.remoteVideoHTMLVideoElement.srcObject=this.mediaStream,this.remoteVideoHTMLVideoElement.width=500,this.remoteVideoHTMLVideoElement.height=500,this.remoteVideoHTMLVideoElement.style.cssText="height:90%",this.remoteVideoHTMLVideoElement.id=this.remoteUser,this.remoteVideoHTMLVideoElement.autoplay=!0}useHtmlCanvasElement(){this.remoteVideoHTMLVideoElement=document.createElement("video"),this.remoteVideoHTMLVideoElement.srcObject=this.mediaStream,this.remoteVideoHTMLVideoElement.id=this.remoteUser,this.remoteVideoHTMLVideoElement.autoplay=!0,this.remoteVideoHTMLCanvasElement=document.createElement("canvas"),this.remoteVideoHTMLCanvasElement.width=500,this.remoteVideoHTMLCanvasElement.height=500,this.remoteVideoHTMLCanvasElement.id=this.remoteUser;let n=this.remoteVideoHTMLCanvasElement.getContext("2d");const r=this;r.remoteVideoHTMLVideoElement&&(r.remoteVideoHTMLVideoElement.onplay=()=>{var h=this.remoteVideoHTMLVideoElement;(function u(){!h.paused&&!h.ended&&(r.remoteVideoHTMLCanvasElement&&(r.remoteVideoHTMLCanvasElement.width=r.remoteVideoHTMLVideoElement.videoWidth,r.remoteVideoHTMLCanvasElement.height=r.remoteVideoHTMLVideoElement.videoHeight),n.drawImage(h,0,0),setTimeout(u,1e3/60))})()})}close(){var n;(n=this.peerConnection)==null||n.close()}}var Ka=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ga(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}function Ja(f){var n=f.default;if(typeof n=="function"){var r=function(){return n.apply(this,arguments)};r.prototype=n.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(f).forEach(function(h){var u=Object.getOwnPropertyDescriptor(f,h);Object.defineProperty(r,h,u.get?u:{enumerable:!0,get:function(){return f[h]}})}),r}var ge={exports:{}};const Qa=Ja(Xa);(function(f,n){(function(h,u){f.exports=u(Qa)})(Ka,r=>(()=>{var h={657:(a,g)=>{Object.defineProperty(g,"__esModule",{value:!0}),g.default=(d,k)=>{const C=d.__vccOpts||d;for(const[S,T]of k)C[S]=T;return C}},976:a=>{a.exports=r}},u={};function i(a){var g=u[a];if(g!==void 0)return g.exports;var d=u[a]={exports:{}};return h[a](d,d.exports,i),d.exports}i.d=(a,g)=>{for(var d in g)i.o(g,d)&&!i.o(a,d)&&Object.defineProperty(a,d,{enumerable:!0,get:g[d]})},i.o=(a,g)=>Object.prototype.hasOwnProperty.call(a,g),i.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})};var x={};return(()=>{i.r(x),i.d(x,{Component:()=>$,LoadingPlugin:()=>D,default:()=>q,useLoading:()=>A});var a=i(976);function g(t){var p;typeof t.remove<"u"?t.remove():(p=t.parentNode)==null||p.removeChild(t)}function d(t,p,b){let w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const _=(0,a.h)(t,p,w),v=document.createElement("div");return v.classList.add("vld-container"),b.appendChild(v),(0,a.render)(_,v),_.component}function k(){return typeof window<"u"}const C=k()?window.HTMLElement:Object,S=["aria-busy"],T={class:"vl-icon"};function U(t,p,b,w,_,v){return(0,a.openBlock)(),(0,a.createBlock)(a.Transition,{name:t.transition},{default:(0,a.withCtx)(()=>[(0,a.withDirectives)((0,a.createElementVNode)("div",{tabindex:"0",class:(0,a.normalizeClass)(["vl-overlay vl-active",{"vl-full-page":t.isFullPage}]),"aria-busy":t.isActive,"aria-label":"Loading",style:(0,a.normalizeStyle)({zIndex:t.zIndex})},[(0,a.createElementVNode)("div",{class:"vl-background",onClick:p[0]||(p[0]=(0,a.withModifiers)(function(){return t.cancel&&t.cancel(...arguments)},["prevent"])),style:(0,a.normalizeStyle)(t.bgStyle)},null,4),(0,a.createElementVNode)("div",T,[(0,a.renderSlot)(t.$slots,"before"),(0,a.renderSlot)(t.$slots,"default",{},()=>[((0,a.openBlock)(),(0,a.createBlock)((0,a.resolveDynamicComponent)(t.loader),{color:t.color,width:t.width,height:t.height},null,8,["color","width","height"]))]),(0,a.renderSlot)(t.$slots,"after")])],14,S),[[a.vShow,t.isActive]])]),_:3},8,["name"])}const H={mounted(){this.enforceFocus&&document.addEventListener("focusin",this.focusIn)},methods:{focusIn(t){if(!this.isActive||t.target===this.$el||this.$el.contains(t.target))return;let p=this.container?this.container:this.isFullPage?null:this.$el.parentElement;(this.isFullPage||p&&p.contains(t.target))&&(t.preventDefault(),this.$el.focus())}},beforeUnmount(){document.removeEventListener("focusin",this.focusIn)}},L=["width","height","stroke"],X=[(0,a.createStaticVNode)('<g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" stroke-width="2"><circle stroke-opacity=".25" cx="18" cy="18" r="18"></circle><path d="M36 18c0-9.94-8.06-18-18-18"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="0.8s" repeatCount="indefinite"></animateTransform></path></g></g>',1)];function K(t,p,b,w,_,v){return(0,a.openBlock)(),(0,a.createElementBlock)("svg",{viewBox:"0 0 38 38",xmlns:"http://www.w3.org/2000/svg",width:t.width,height:t.height,stroke:t.color},X,8,L)}const G=(0,a.defineComponent)({name:"spinner",props:{color:{type:String,default:"#000"},height:{type:Number,default:64},width:{type:Number,default:64}}});var N=i(657);const J=(0,N.default)(G,[["render",K]]),z=["fill","width","height"],Y=[(0,a.createStaticVNode)('<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity="0.3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="0.5" to="0.5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',3)];function Z(t,p,b,w,_,v){return(0,a.openBlock)(),(0,a.createElementBlock)("svg",{viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",fill:t.color,width:t.width,height:t.height},Y,8,z)}const ee=(0,a.defineComponent)({name:"dots",props:{color:{type:String,default:"#000"},height:{type:Number,default:240},width:{type:Number,default:60}}}),te=(0,N.default)(ee,[["render",Z]]),ae=["height","width","fill"],s=[(0,a.createStaticVNode)('<rect x="0" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0s" dur="0.6s" repeatCount="indefinite"></animate><animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0s" dur="0.6s" repeatCount="indefinite"></animate></rect><rect x="10" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0.15s" dur="0.6s" repeatCount="indefinite"></animate><animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0.15s" dur="0.6s" repeatCount="indefinite"></animate></rect><rect x="20" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0.3s" dur="0.6s" repeatCount="indefinite"></animate><animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0.3s" dur="0.6s" repeatCount="indefinite"></animate></rect>',3)];function o(t,p,b,w,_,v){return(0,a.openBlock)(),(0,a.createElementBlock)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",height:t.height,width:t.width,fill:t.color},s,8,ae)}const c=(0,a.defineComponent)({name:"bars",props:{color:{type:String,default:"#000"},height:{type:Number,default:40},width:{type:Number,default:40}}}),V={Spinner:J,Dots:te,Bars:(0,N.default)(c,[["render",o]])},m=(0,a.defineComponent)({name:"VueLoading",mixins:[H],props:{active:Boolean,programmatic:Boolean,container:[Object,Function,C],isFullPage:{type:Boolean,default:!0},enforceFocus:{type:Boolean,default:!0},lockScroll:Boolean,transition:{type:String,default:"fade"},canCancel:Boolean,onCancel:{type:Function,default:()=>{}},color:String,backgroundColor:String,opacity:Number,width:Number,height:Number,zIndex:Number,loader:{type:String,default:"spinner"}},components:V,emits:["hide","update:active"],data(){return{isActive:this.active}},mounted(){document.addEventListener("keyup",this.keyPress)},methods:{cancel(){!this.canCancel||!this.isActive||(this.hide(),this.onCancel.apply(null,arguments))},hide(){this.$emit("hide"),this.$emit("update:active",!1),this.programmatic&&(this.isActive=!1,setTimeout(()=>{const t=this.$el.parentElement;(0,a.render)(null,t),g(t)},150))},disableScroll(){this.isFullPage&&this.lockScroll&&document.body.classList.add("vl-shown")},enableScroll(){this.isFullPage&&this.lockScroll&&document.body.classList.remove("vl-shown")},keyPress(t){t.keyCode===27&&this.cancel()}},watch:{active(t){this.isActive=t},isActive(t){t?this.disableScroll():this.enableScroll()}},computed:{bgStyle(){return{background:this.backgroundColor,opacity:this.opacity}}},beforeUnmount(){document.removeEventListener("keyup",this.keyPress)}}),$=(0,N.default)(m,[["render",U]]);function A(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return{show(){let b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t,w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:p;const v={...t,...b,...{programmatic:!0,lockScroll:!0,isFullPage:!1,active:!0}};let R=v.container;v.container||(R=document.body,v.isFullPage=!0);const be={...p,...w};return{hide:d($,v,R,be).ctx.hide}}}}const D=function(t){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const w=A(p,b);t.config.globalProperties.$loading=w,t.provide("$loading",w)},q=$})(),x})())})(ge);const Ya=Ga(ge.exports);const Za="/ChatRoom/assets/close.1710688365135.svg",de="/ChatRoom/assets/play_arrow.1710688365135.svg",es={class:"bg-gradient-to-b from-gray-400 via-gray-800 to-black w-full min-h-screen"},ts={class:"bg-gradient-to-t from-blue-200 to-gray-800 opacity-90 fixed w-full z-40 border-b-2 border-platinum h-header"},as={class:"flex p-3 max-w-8xl m-auto h-header"},ss={class:"max-w-one-three w-full flex md:flex-column text-center items-center"},os={class:"flex w-full justify-start items-center"},ns=l("img",{src:za,class:"max-w-one-three"},null,-1),is={class:"text-zinc-100 px-1 text-xs sm:text-base max-w-one-three sm:max-w-one-two truncate md:max-w-full"},rs=["src"],ls={class:"max-w-one-three w-full flex justify-center items-center"},cs={class:"text-xs sm:text-base text-zinc-100 p-2 truncate"},ds={class:"box-border pt-20 max-w-8xl m-auto px-3 text-2xl min-h-screen flex"},us={class:"text-2xl mx-auto w-full"},ms=l("div",{id:"LocalVideo",class:"z-50 fixed top-0 left-0 md:w-250 md:h-250 w-100 h-100"},null,-1),ps={id:"RemoteVideos",class:"flex justify-center flex-row flex-wrap"},fs=["id"],hs={class:"text-white text-sm text-center"},vs={id:"MessageWrap",class:"fixed z-50 left-0 bottom-0 w-full flex justify-start"},gs={class:"rounded-md max-w-one-two bg-slate-600 p-3"},bs={id:"Message",class:"flex flex-col text-sm text-yellow-900"},_s={class:"my-1 rounded-md inline bg-white p-2"},ys=l("div",{class:"bg-slate-400 h-1 my-2"},null,-1),ws={class:"flex justify-center"},Es=pe({__name:"Room",setup(f){const n=Da(),r={IceServerList:ne,Offer:X,Answer:K,Candidate:G,NewUser:N,UserLeaveFromRoom:J,BroadcastMessage:ie};Object.entries(r).forEach(([e,s])=>{var o;(o=n.state.socketInstance)==null||o.subscribe(e,s)}),n.state.roomIsSubscribe=!0;const h={audio:!0,video:{width:{ideal:1280},height:{ideal:720}}},u=n.state.socketInstance,i=new Map,x=qa(),a=n.state.user,g=E(!0),d=E(),k=E(!1),C=E(),S=E(),T=E(!1),U=E(de),H=E(),L=E([]);if(u){const e={Type:P.getIceServerlist,Data:{RoomId:x.query.room}};u.wsSend(e)}else le.push({name:"Lobby"});function ne(e){d.value=e}async function X(e){for(;d.value==null&&Date.now()-Date.now()<3e3;)await new Promise(s=>setTimeout(s,16));if(d.value==null){console.error("Failed to get iceServerList.value within the maximum wait time");return}if(i.has(e.ReqId))i.has(e.ReqId)&&await z(i.get(e.ReqId),e);else{const s=new ce(e.ReqId,d.value,n.state.useFirefoxAndNvidia,k);i.set(e.ReqId,s),await z(s,e)}}async function K(e){for(;d.value==null&&Date.now()-Date.now()<3e3;)await new Promise(s=>setTimeout(s,16));if(d.value==null){console.error("Failed to get iceServerList.value within the maximum wait time");return}i.has(e.ReqId)&&await Y(i.get(e.ReqId),e)}async function G(e){var o;for(;d.value==null&&Date.now()-Date.now()<3e3;)await new Promise(c=>setTimeout(c,16));if(d.value==null){console.error("Failed to get iceServerList.value within the maximum wait time");return}const s=i.get(e.ReqId);(o=s==null?void 0:s.peerConnection)==null||o.addIceCandidate({sdpMid:e.SdpMid,sdpMLineIndex:e.SdpMLineIndex,candidate:e.Candidate})}async function N(e){for(;d.value==null&&Date.now()-Date.now()<3e3;)await new Promise(s=>setTimeout(s,16));if(d.value==null){console.error("Failed to get iceServerList.value within the maximum wait time");return}!i.has(e.NewUser)&&T.value&&await Q(e.NewUser)}function ie(e){L.value.push({MessageSender:e.MessageSender,Message:e.Message}),L.value.length>=10&&L.value.splice(0,1)}function J(e){i.has(e.LeaveUser)&&(i.get(e.LeaveUser).close(),i.delete(e.LeaveUser))}async function z(e,s){var M,I,V;e.peerConnection.onicecandidate=m=>{if(!m.candidate||!m.candidate.candidate)return;const W={Type:P.sendCandidate,Data:{RoomId:x.query.room,SdpMid:m.candidate.sdpMid||"0",SdpMLineIndex:m.candidate.sdpMLineIndex,RecvId:s.ReqId,Candidate:m.candidate.candidate}};u.wsSend(W)},await((M=e.peerConnection)==null?void 0:M.setRemoteDescription(new RTCSessionDescription({sdp:s.Desc.Sdp,type:s.Desc.Type})));let o=await((I=e.peerConnection)==null?void 0:I.createAnswer());(o==null?void 0:o.sdp)&&n.state.useFirefoxAndNvidia&&!g.value&&(o.sdp=te(o.sdp,"H264")),await((V=e.peerConnection)==null?void 0:V.setLocalDescription(o));const c={Type:P.answer,Data:{RoomId:x.query.room,RecvId:s.ReqId,Desc:o}};u.wsSend(c)}async function Q(e){var s;if(!i.has(e)){const o=new ce(e,d.value,n.state.useFirefoxAndNvidia,k);i.set(e,o)}if(i.has(e)){const o=i.get(e);if(((s=o.peerConnection)==null?void 0:s.signalingState)=="have-remote-offer")return;o.peerConnection.onicecandidate=c=>{if(!c.candidate||!c.candidate.candidate)return;const M={Type:P.sendCandidate,Data:{RoomId:x.query.room,SdpMid:c.candidate.sdpMid||"0",SdpMLineIndex:c.candidate.sdpMLineIndex,RecvId:o.remoteUser,Candidate:c.candidate.candidate}};u.wsSend(M)},o.peerConnection.onnegotiationneeded=async function(){const c=await o.peerConnection.createOffer();o.isOffer=!0,await o.peerConnection.setLocalDescription(c);const M={Type:P.offer,Data:{RoomId:x.query.room,RecvId:i.get(e).remoteUser,Desc:c}};u.wsSend(M)},C.value.getTracks().forEach(c=>{o.peerConnection.addTrack(c,C.value)})}}async function Y(e,s){var c;const o={sdp:s.Desc.Sdp,type:s.Desc.Type};(c=e.peerConnection)==null||c.setRemoteDescription(o)}async function Z(){return navigator.mediaDevices.getUserMedia(h).then(e=>{C.value=e,S.value=document.createElement("video"),S.value.srcObject=C.value,S.value.classList.add("rounded-full","aspect-square","border-8","bg-black","border-slate-600"),S.value.autoplay=!0;const s=document.getElementById("LocalVideo");s==null||s.appendChild(S.value)}).catch(e=>{alert("Browser doesn't support or there is some errors."+e)})}async function ee(){var e;if(T.value=!T.value,T.value?U.value=Za:U.value=de,T.value)await Z(),n.state.Room.UserList.forEach(async s=>{s!=a.id&&await Q(s)});else{(e=C.value)==null||e.getTracks().forEach(o=>{o.stop()});const s=document.getElementById("LocalVideo");s==null||s.removeChild(S.value)}}function re(){const e={Type:P.broadcastMessage,Data:{RoomId:x.query.room,Message:H.value}};u.wsSend(e),L.value.push({MessageSender:"me",Message:H.value}),L.value.length>=10&&L.value.splice(0,1),H.value=""}function te(e,s){var o=function(c){var M=new RegExp("(a=rtpmap:(\\d*) "+s+"/90000\\r\\n)"),I=c.match(M);if(I==null||I.length<=2)return c;var V=I[2],m=c.replace(M,""),W=new RegExp("(a=rtcp-fb:"+V+`.*\r
)`,"g");m=m.replace(W,"");var $=new RegExp("(a=fmtp:"+V+`.*\r
)`,"g");m=m.replace($,"");var A=new RegExp("(a=fmtp:(\\d*) apt="+V+"\\r\\n)"),D=m.match(A),q="";if(D!=null&&D.length>=3){q=D[2],m=m.replace(A,"");var t=new RegExp("(a=rtpmap:"+q+`.*\r
)`,"g");m=m.replace(t,"")}var p=/(m=video.*\r\n)/,b=m.match(p);if(b!=null){for(var w=b[0].substring(0,b[0].length-2),_=w.split(" "),v=_[0],R=1;R<_.length;R++)_[R]==V||_[R]==q||(v+=" "+_[R]);v+=`\r
`,m=m.replace(p,v)}return o(m)};return o(e)}function ae(){le.push({name:"Lobby"})}return fe(()=>{var e;Object.entries(r).forEach(([s,o])=>{var c;(c=n.state.socketInstance)==null||c.unSubscribe(s,o)}),i.forEach(s=>{s.close()}),(e=C.value)==null||e.getTracks().forEach(s=>{s.stop()}),S.value=null,i.clear()}),(e,s)=>(O(),F("div",es,[l("div",ts,[l("header",as,[l("div",ss,[l("div",os,[ns,l("p",is,j(B(a).id),1),l("button",{onClick:ee,class:"bg-red-500 max-w-one-three hover:bg-red-700 focus:outline-none focus:ring focus:ring-red-300 sm:text-sm active:bg-red-700 p-2 rounded-full"},[l("img",{src:U.value,class:"cursor-pointer",alt:"userImage"},null,8,rs)])])]),l("div",ls,[l("div",null,[l("p",cs," Room:"+j(B(x).query.room),1)])]),l("div",{class:"max-w-one-three w-full flex justify-end items-center"},[l("button",{onClick:ae,class:"bg-sky-500 hover:bg-sky-700 focus:outline-none focus:ring focus:ring-sky-300 active:bg-sky-700 px-5 py-2 text-xs leading-5 sm:text-base rounded-full font-semibold text-white"}," Home ")])])]),l("div",ds,[l("div",us,[ms,l("div",ps,[me(B(Ya),{active:k.value,"onUpdate:active":s[0]||(s[0]=o=>k.value=o),"can-cancel":!1,"is-full-page":!1},null,8,["active"]),(O(!0),F(se,null,oe(B(n).state.Room.UserList.filter(o=>o!==B(n).state.user.id),o=>(O(),F("div",{id:o,class:"m-4 border-8 border-slate-400 rounded-md flex flex-col justify-center",style:{width:"500px",height:"500px"}},[l("p",hs,j(o),1)],8,fs))),256))]),l("div",vs,[l("div",gs,[l("div",bs,[(O(!0),F(se,null,oe(L.value,o=>(O(),F("div",_s,[l("p",null,[l("span",null,j(o.MessageSender)+": ",1),ue(j(o.Message),1)])]))),256))]),ys,l("div",ws,[he(l("input",{class:"max-w-one-two md:max-w-full rounded-full text-base px-2 my-1 mx-1","onUpdate:modelValue":s[1]||(s[1]=o=>H.value=o)},null,512),[[ve,H.value]]),l("button",{onClick:re,class:"bg-gray-500 hover:bg-gray-700 focus:outline-none focus:ring focus:ring-gray-300 active:bg-gray-700 px-3 py-2 leading-5 text-sm rounded-full font-semibold text-white"}," Send ")])])])])])]))}});export{Es as default};
