var _e=Object.defineProperty;var we=(f,n,r)=>n in f?_e(f,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):f[n]=r;var b=(f,n,r)=>(we(f,typeof n!="symbol"?n+"":n,r),r);import{E as xe,R as Ce,m as Se,p as Me,q as Ee,s as Te,v as Le,x as Ve,y as ke,z as Re,A as Ie,B as Ne,C as He,D as Pe,G as je,H as Be,r as M,I as Oe,J as Fe,K as Ue,L as $e,M as Ae,N as qe,O as De,P as ze,u as D,Q as We,S as Xe,n as Ke,T as Ge,U as Je,t as A,V as Qe,W as Ye,X as Ze,F as ue,Y as et,Z as tt,_ as at,$ as st,a0 as ot,a1 as nt,a2 as it,a3 as rt,a4 as lt,c as dt,a5 as ct,g as ut,a as z,b as l,a6 as mt,a7 as pt,a8 as ft,a9 as ht,aa as gt,l as me,e as pe,ab as vt,d as fe,ac as bt,ad as yt,ae as _t,af as wt,ag as xt,ah as Ct,ai as St,aj as Mt,ak as Et,al as Tt,am as Lt,an as Vt,ao as kt,ap as Rt,aq as It,ar as Nt,as as Ht,at as Pt,au as jt,av as Bt,aw as Ot,ax as Ft,ay as Ut,o as $t,az as At,aA as qt,aB as Dt,aC as he,aD as zt,k as W,aE as Wt,aF as Xt,aG as Kt,aH as Gt,aI as Jt,f as ge,aJ as Qt,j as Yt,aK as Zt,aL as ea,aM as ta,aN as aa,aO as sa,aP as oa,aQ as na,aR as ia,aS as ra,aT as la,aU as da,aV as ca,aW as ua,aX as ma,aY as pa,aZ as fa,a_ as ha,w as ga,a$ as va,b0 as ba,b1 as ya,b2 as _a,b3 as wa,b4 as xa,b5 as ve,b6 as Ca,b7 as Sa,b8 as Ma,b9 as Ea,ba as Ta,bb as La,bc as Va,bd as ka,be as Ra,bf as Ia,bg as Na,bh as Ha,bi as Pa,bj as ja,bk as Ba,bl as Oa,bm as Fa,bn as Ua,bo as be,bp as $a,bq as Aa,br as qa,i as le,h as Da,bs as za}from"./index.1706288930841.js";import{E as O,_ as Wa}from"./eventType.1706288930841.js";const Xa=()=>{},Ka=Object.freeze(Object.defineProperty({__proto__:null,compile:Xa,EffectScope:xe,ReactiveEffect:Ce,customRef:Se,effect:Me,effectScope:Ee,getCurrentScope:Te,isProxy:Le,isReactive:Ve,isReadonly:ke,isRef:Re,isShallow:Ie,markRaw:Ne,onScopeDispose:He,proxyRefs:Pe,reactive:je,readonly:Be,ref:M,shallowReactive:Oe,shallowReadonly:Fe,shallowRef:Ue,stop:$e,toRaw:Ae,toRef:qe,toRefs:De,triggerRef:ze,unref:D,camelize:We,capitalize:Xe,normalizeClass:Ke,normalizeProps:Ge,normalizeStyle:Je,toDisplayString:A,toHandlerKey:Qe,BaseTransition:Ye,Comment:Ze,Fragment:ue,KeepAlive:et,Static:tt,Suspense:at,Teleport:st,Text:ot,callWithAsyncErrorHandling:nt,callWithErrorHandling:it,cloneVNode:rt,compatUtils:lt,computed:dt,createBlock:ct,createCommentVNode:ut,createElementBlock:z,createElementVNode:l,createHydrationRenderer:mt,createPropsRestProxy:pt,createRenderer:ft,createSlots:ht,createStaticVNode:gt,createTextVNode:me,createVNode:pe,defineAsyncComponent:vt,defineComponent:fe,defineEmits:bt,defineExpose:yt,defineProps:_t,get devtools(){return wt},getCurrentInstance:xt,getTransitionRawChildren:Ct,guardReactiveProps:St,h:Mt,handleError:Et,initCustomFormatter:Tt,inject:Lt,isMemoSame:Vt,isRuntimeOnly:kt,isVNode:Rt,mergeDefaults:It,mergeProps:Nt,nextTick:Ht,onActivated:Pt,onBeforeMount:jt,onBeforeUnmount:Bt,onBeforeUpdate:Ot,onDeactivated:Ft,onErrorCaptured:Ut,onMounted:$t,onRenderTracked:At,onRenderTriggered:qt,onServerPrefetch:Dt,onUnmounted:he,onUpdated:zt,openBlock:W,popScopeId:Wt,provide:Xt,pushScopeId:Kt,queuePostFlushCb:Gt,registerRuntimeCompiler:Jt,renderList:ge,renderSlot:Qt,resolveComponent:Yt,resolveDirective:Zt,resolveDynamicComponent:ea,resolveFilter:ta,resolveTransitionHooks:aa,setBlockTracking:sa,setDevtoolsHook:oa,setTransitionHooks:na,ssrContextKey:ia,ssrUtils:ra,toHandlers:la,transformVNodeArgs:da,useAttrs:ca,useSSRContext:ua,useSlots:ma,useTransitionState:pa,version:fa,warn:ha,watch:ga,watchEffect:va,watchPostEffect:ba,watchSyncEffect:ya,withAsyncContext:_a,withCtx:wa,withDefaults:xa,withDirectives:ve,withMemo:Ca,withScopeId:Sa,Transition:Ma,TransitionGroup:Ea,VueElement:Ta,createApp:La,createSSRApp:Va,defineCustomElement:ka,defineSSRCustomElement:Ra,hydrate:Ia,initDirectivesForSSR:Na,render:Ha,useCssModule:Pa,useCssVars:ja,vModelCheckbox:Ba,vModelDynamic:Oa,vModelRadio:Fa,vModelSelect:Ua,vModelText:be,vShow:$a,withKeys:Aa,withModifiers:qa},Symbol.toStringTag,{value:"Module"}));class de{constructor(n,r,p,c,i){b(this,"remoteUser","");b(this,"role","");b(this,"peerConnection");b(this,"iceconfig");b(this,"isOntrack",!1);b(this,"isOffer",!1);b(this,"isLoading");b(this,"remoteVideoHTMLVideoElement");b(this,"remoteVideoHTMLCanvasElement");b(this,"remoteWrap",document.createElement("div"));b(this,"VideoWraps",document.getElementById("RemoteVideos"));b(this,"mediaStream",new MediaStream);b(this,"mediaStreamId","");this.remoteUser=n,this.role=i,this.iceconfig=r,this.isLoading=c,p?this.useHtmlCanvasElement():this.useHtmlVideoElement(),this.init()}init(){const n={iceServers:this.iceconfig.iceServers};this.peerConnection=new RTCPeerConnection(n),this.peerConnection.ontrack=r=>{var p,c;this.mediaStreamId!=r.streams[0].id&&(this.mediaStreamId=r.streams[0].id,this.mediaStream.getTracks()&&this.mediaStream.getTracks().forEach(i=>{this.mediaStream.removeTrack(i)})),this.mediaStream.addTrack(r.track),this.isOntrack=!0,(p=this.remoteVideoHTMLVideoElement)==null||p.play(),this.isLoading.value=!1,(c=this.VideoWraps)==null||c.appendChild(this.remoteWrap)}}useHtmlVideoElement(){this.remoteVideoHTMLVideoElement=document.createElement("video"),this.remoteVideoHTMLVideoElement.srcObject=this.mediaStream,this.remoteVideoHTMLVideoElement.width=500,this.remoteVideoHTMLVideoElement.height=500,this.remoteVideoHTMLVideoElement.style.cssText="height:90%",this.remoteVideoHTMLVideoElement.id=this.remoteUser;const n=document.createElement("p");n.textContent=this.remoteUser,n.classList.add("text-white","text-sm","text-center"),this.remoteWrap.classList.add("m-4","border-8","border-slate-400","rounded-md","flex","flex-col","justify-center"),this.remoteWrap.style.cssText="width:500px;height:500px",this.remoteVideoHTMLVideoElement.autoplay=!0,this.remoteWrap.appendChild(this.remoteVideoHTMLVideoElement),this.remoteWrap.appendChild(n)}useHtmlCanvasElement(){this.remoteVideoHTMLVideoElement=document.createElement("video"),this.remoteVideoHTMLVideoElement.srcObject=this.mediaStream,this.remoteVideoHTMLVideoElement.id=this.remoteUser,this.remoteVideoHTMLVideoElement.autoplay=!0,this.remoteVideoHTMLCanvasElement=document.createElement("canvas"),this.remoteVideoHTMLCanvasElement.width=500,this.remoteVideoHTMLCanvasElement.height=500,this.remoteVideoHTMLCanvasElement.id=this.remoteUser;const n=document.createElement("p");n.textContent=this.remoteUser,n.classList.add("text-white","text-sm","text-center"),this.remoteWrap.classList.add("m-4","border-8","border-slate-400","rounded-md","flex","flex-col","justify-center"),this.remoteWrap.style.cssText="width:500px;height:500px",this.remoteWrap.appendChild(this.remoteVideoHTMLCanvasElement),this.remoteWrap.appendChild(n);let r=this.remoteVideoHTMLCanvasElement.getContext("2d");const p=this;p.remoteVideoHTMLVideoElement&&(p.remoteVideoHTMLVideoElement.onplay=()=>{var c=this.remoteVideoHTMLVideoElement;(function i(){!c.paused&&!c.ended&&(p.remoteVideoHTMLCanvasElement&&(p.remoteVideoHTMLCanvasElement.width=p.remoteVideoHTMLVideoElement.videoWidth,p.remoteVideoHTMLCanvasElement.height=p.remoteVideoHTMLVideoElement.videoHeight),r.drawImage(c,0,0),setTimeout(i,1e3/60))})()})}close(){var n,r;(n=this.peerConnection)==null||n.close(),this.isOntrack&&((r=this.VideoWraps)==null||r.removeChild(this.remoteWrap))}}var Ga=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ja(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}function Qa(f){var n=f.default;if(typeof n=="function"){var r=function(){return n.apply(this,arguments)};r.prototype=n.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(f).forEach(function(p){var c=Object.getOwnPropertyDescriptor(f,p);Object.defineProperty(r,p,c.get?c:{enumerable:!0,get:function(){return f[p]}})}),r}var ye={exports:{}};const Ya=Qa(Ka);(function(f,n){(function(p,c){f.exports=c(Ya)})(Ga,r=>(()=>{var p={657:(s,h)=>{Object.defineProperty(h,"__esModule",{value:!0}),h.default=(g,w)=>{const L=g.__vccOpts||g;for(const[E,T]of w)L[E]=T;return L}},976:s=>{s.exports=r}},c={};function i(s){var h=c[s];if(h!==void 0)return h.exports;var g=c[s]={exports:{}};return p[s](g,g.exports,i),g.exports}i.d=(s,h)=>{for(var g in h)i.o(h,g)&&!i.o(s,g)&&Object.defineProperty(s,g,{enumerable:!0,get:h[g]})},i.o=(s,h)=>Object.prototype.hasOwnProperty.call(s,h),i.r=s=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})};var _={};return(()=>{i.r(_),i.d(_,{Component:()=>u,LoadingPlugin:()=>oe,default:()=>q,useLoading:()=>j});var s=i(976);function h(t){var m;typeof t.remove<"u"?t.remove():(m=t.parentNode)==null||m.removeChild(t)}function g(t,m,C){let y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const S=(0,s.h)(t,m,y),v=document.createElement("div");return v.classList.add("vld-container"),C.appendChild(v),(0,s.render)(S,v),S.component}function w(){return typeof window<"u"}const L=w()?window.HTMLElement:Object,E=["aria-busy"],T={class:"vl-icon"};function N(t,m,C,y,S,v){return(0,s.openBlock)(),(0,s.createBlock)(s.Transition,{name:t.transition},{default:(0,s.withCtx)(()=>[(0,s.withDirectives)((0,s.createElementVNode)("div",{tabindex:"0",class:(0,s.normalizeClass)(["vl-overlay vl-active",{"vl-full-page":t.isFullPage}]),"aria-busy":t.isActive,"aria-label":"Loading",style:(0,s.normalizeStyle)({zIndex:t.zIndex})},[(0,s.createElementVNode)("div",{class:"vl-background",onClick:m[0]||(m[0]=(0,s.withModifiers)(function(){return t.cancel&&t.cancel(...arguments)},["prevent"])),style:(0,s.normalizeStyle)(t.bgStyle)},null,4),(0,s.createElementVNode)("div",T,[(0,s.renderSlot)(t.$slots,"before"),(0,s.renderSlot)(t.$slots,"default",{},()=>[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(t.loader),{color:t.color,width:t.width,height:t.height},null,8,["color","width","height"]))]),(0,s.renderSlot)(t.$slots,"after")])],14,E),[[s.vShow,t.isActive]])]),_:3},8,["name"])}const F={mounted(){this.enforceFocus&&document.addEventListener("focusin",this.focusIn)},methods:{focusIn(t){if(!this.isActive||t.target===this.$el||this.$el.contains(t.target))return;let m=this.container?this.container:this.isFullPage?null:this.$el.parentElement;(this.isFullPage||m&&m.contains(t.target))&&(t.preventDefault(),this.$el.focus())}},beforeUnmount(){document.removeEventListener("focusin",this.focusIn)}},H=["width","height","stroke"],X=[(0,s.createStaticVNode)('<g fill="none" fill-rule="evenodd"><g transform="translate(1 1)" stroke-width="2"><circle stroke-opacity=".25" cx="18" cy="18" r="18"></circle><path d="M36 18c0-9.94-8.06-18-18-18"><animateTransform attributeName="transform" type="rotate" from="0 18 18" to="360 18 18" dur="0.8s" repeatCount="indefinite"></animateTransform></path></g></g>',1)];function K(t,m,C,y,S,v){return(0,s.openBlock)(),(0,s.createElementBlock)("svg",{viewBox:"0 0 38 38",xmlns:"http://www.w3.org/2000/svg",width:t.width,height:t.height,stroke:t.color},X,8,H)}const G=(0,s.defineComponent)({name:"spinner",props:{color:{type:String,default:"#000"},height:{type:Number,default:64},width:{type:Number,default:64}}});var P=i(657);const J=(0,P.default)(G,[["render",K]]),Q=["fill","width","height"],U=[(0,s.createStaticVNode)('<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity="0.3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="0.5" to="0.5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',3)];function Z(t,m,C,y,S,v){return(0,s.openBlock)(),(0,s.createElementBlock)("svg",{viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",fill:t.color,width:t.width,height:t.height},U,8,Q)}const ee=(0,s.defineComponent)({name:"dots",props:{color:{type:String,default:"#000"},height:{type:Number,default:240},width:{type:Number,default:60}}}),te=(0,P.default)(ee,[["render",Z]]),ae=["height","width","fill"],se=[(0,s.createStaticVNode)('<rect x="0" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0s" dur="0.6s" repeatCount="indefinite"></animate><animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0s" dur="0.6s" repeatCount="indefinite"></animate></rect><rect x="10" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0.15s" dur="0.6s" repeatCount="indefinite"></animate><animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0.15s" dur="0.6s" repeatCount="indefinite"></animate></rect><rect x="20" y="13" width="4" height="5"><animate attributeName="height" attributeType="XML" values="5;21;5" begin="0.3s" dur="0.6s" repeatCount="indefinite"></animate><animate attributeName="y" attributeType="XML" values="13; 5; 13" begin="0.3s" dur="0.6s" repeatCount="indefinite"></animate></rect>',3)];function e(t,m,C,y,S,v){return(0,s.openBlock)(),(0,s.createElementBlock)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 30 30",height:t.height,width:t.width,fill:t.color},se,8,ae)}const a=(0,s.defineComponent)({name:"bars",props:{color:{type:String,default:"#000"},height:{type:Number,default:40},width:{type:Number,default:40}}}),x={Spinner:J,Dots:te,Bars:(0,P.default)(a,[["render",e]])},k=(0,s.defineComponent)({name:"VueLoading",mixins:[F],props:{active:Boolean,programmatic:Boolean,container:[Object,Function,L],isFullPage:{type:Boolean,default:!0},enforceFocus:{type:Boolean,default:!0},lockScroll:Boolean,transition:{type:String,default:"fade"},canCancel:Boolean,onCancel:{type:Function,default:()=>{}},color:String,backgroundColor:String,opacity:Number,width:Number,height:Number,zIndex:Number,loader:{type:String,default:"spinner"}},components:x,emits:["hide","update:active"],data(){return{isActive:this.active}},mounted(){document.addEventListener("keyup",this.keyPress)},methods:{cancel(){!this.canCancel||!this.isActive||(this.hide(),this.onCancel.apply(null,arguments))},hide(){this.$emit("hide"),this.$emit("update:active",!1),this.programmatic&&(this.isActive=!1,setTimeout(()=>{const t=this.$el.parentElement;(0,s.render)(null,t),h(t)},150))},disableScroll(){this.isFullPage&&this.lockScroll&&document.body.classList.add("vl-shown")},enableScroll(){this.isFullPage&&this.lockScroll&&document.body.classList.remove("vl-shown")},keyPress(t){t.keyCode===27&&this.cancel()}},watch:{active(t){this.isActive=t},isActive(t){t?this.disableScroll():this.enableScroll()}},computed:{bgStyle(){return{background:this.backgroundColor,opacity:this.opacity}}},beforeUnmount(){document.removeEventListener("keyup",this.keyPress)}}),u=(0,P.default)(k,[["render",N]]);function j(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return{show(){let C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t,y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:m;const v={...t,...C,...{programmatic:!0,lockScroll:!0,isFullPage:!1,active:!0}};let I=v.container;v.container||(I=document.body,v.isFullPage=!0);const $={...m,...y};return{hide:g(u,v,I,$).ctx.hide}}}}const oe=function(t){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const y=j(m,C);t.config.globalProperties.$loading=y,t.provide("$loading",y)},q=u})(),_})())})(ye);const Za=Ja(ye.exports);const es="/ChatRoom/assets/close.1706288930841.svg",ce="/ChatRoom/assets/play_arrow.1706288930841.svg",ts={class:"bg-gradient-to-b from-gray-400 via-gray-800 to-black w-full min-h-screen"},as={class:"bg-gradient-to-t from-blue-200 to-gray-800 opacity-90 fixed w-full z-40 border-b-2 border-platinum h-header"},ss={class:"flex p-3 max-w-8xl m-auto h-header"},os={class:"max-w-one-three w-full flex md:flex-column text-center items-center"},ns={class:"flex w-full justify-start items-center"},is=l("img",{src:Wa,class:"max-w-one-three"},null,-1),rs={class:"text-zinc-100 px-1 text-xs sm:text-base max-w-one-three sm:max-w-one-two truncate md:max-w-full"},ls=["src"],ds={class:"max-w-one-three w-full flex justify-center items-center"},cs={class:"text-xs sm:text-base text-zinc-100 p-2 truncate"},us={class:"box-border pt-20 max-w-8xl m-auto px-3 text-2xl min-h-screen flex"},ms={class:"text-2xl mx-auto w-full"},ps=l("div",{id:"LocalVideo",class:"z-50 fixed top-0 left-0 md:w-250 md:h-250 w-100 h-100"},null,-1),fs={id:"RemoteVideos",class:"flex justify-center flex-row flex-wrap"},hs={id:"MessageWrap",class:"fixed z-50 left-0 bottom-0 w-full flex justify-start"},gs={class:"rounded-md max-w-one-two bg-slate-600 p-3"},vs={id:"Message",class:"flex flex-col text-sm text-yellow-900"},bs={class:"my-1 rounded-md inline bg-white p-2"},ys=l("div",{class:"bg-slate-400 h-1 my-2"},null,-1),_s={class:"flex justify-center"},Ss=fe({__name:"Room",setup(f){const n=Da(),r={IceServerList:X,Offer:K,Answer:G,Candidate:P,NewUser:ne,UserLeaveFromRoom:Q,BroadcastMessage:J};Object.entries(r).forEach(([e,a])=>{var o;(o=n.state.socketInstance)==null||o.subscribe(e,a)}),n.state.roomIsSubscribe=!0;const p={audio:!0,video:{width:{ideal:1280},height:{ideal:720}}},c=n.state.socketInstance,i=new Map,_=za(),s=M(),h=n.state.user,g=M(!0),w=M(),L=M(!1),E=M(),T=M(),N=M(!1),F=M(ce),H=M(),V=M([]);if(c){const e={Type:O.getIceServerlist,Data:{RoomId:_.query.room}};c.wsSend(e)}else le.push({name:"Lobby"});function X(e){w.value=e}async function K(e){for(;w.value==null;)await new Promise(a=>setTimeout(a,16));if(i.has(e.ReqId))i.has(e.ReqId)&&await Y(i.get(e.ReqId),e);else{const a=new de(e.ReqId,w.value,n.state.useFirefoxAndNvidia,L);i.set(e.ReqId,a),await Y(a,e)}}async function G(e){for(;w.value==null;)await new Promise(a=>setTimeout(a,16));i.has(e.ReqId)&&await Z(i.get(e.ReqId),e)}async function P(e){var o;for(;w.value==null;)await new Promise(d=>setTimeout(d,16));const a=i.get(e.ReqId);(o=a==null?void 0:a.peerConnection)==null||o.addIceCandidate({sdpMid:e.SdpMid,sdpMLineIndex:e.SdpMLineIndex,candidate:e.Candidate})}async function ne(e){for(s.value=e;w.value==null;)await new Promise(a=>setTimeout(a,16));!i.has(e.NewUser)&&N.value&&await U(e.NewUser)}function J(e){V.value.push({MessageSender:e.MessageSender,Message:e.Message}),V.value.length>=10&&V.value.splice(0,1)}function Q(e){i.has(e.LeaveUser)&&te(i.get(e.LeaveUser),e)}async function Y(e,a){var x,k,R;e.peerConnection.onicecandidate=u=>{if(!u.candidate||!u.candidate.candidate)return;const j={Type:O.sendCandidate,Data:{RoomId:_.query.room,SdpMid:u.candidate.sdpMid||"0",SdpMLineIndex:u.candidate.sdpMLineIndex,RecvId:a.ReqId,Candidate:u.candidate.candidate}};c.wsSend(j)},await((x=e.peerConnection)==null?void 0:x.setRemoteDescription(new RTCSessionDescription({sdp:a.Desc.Sdp,type:a.Desc.Type})));let o=await((k=e.peerConnection)==null?void 0:k.createAnswer());(o==null?void 0:o.sdp)&&n.state.useFirefoxAndNvidia&&!g.value&&(o.sdp=re(o.sdp,"H264")),await((R=e.peerConnection)==null?void 0:R.setLocalDescription(o));const d={Type:O.answer,Data:{RoomId:_.query.room,RecvId:a.ReqId,Desc:o}};c.wsSend(d)}async function U(e){var a;if(!i.has(e)){const o=new de(e,w.value,n.state.useFirefoxAndNvidia,L);i.set(e,o)}if(i.has(e)){const o=i.get(e);if(((a=o.peerConnection)==null?void 0:a.signalingState)=="have-remote-offer")return;o.peerConnection.onicecandidate=d=>{if(!d.candidate||!d.candidate.candidate)return;const x={Type:O.sendCandidate,Data:{RoomId:_.query.room,SdpMid:d.candidate.sdpMid||"0",SdpMLineIndex:d.candidate.sdpMLineIndex,RecvId:o.remoteUser,Candidate:d.candidate.candidate}};c.wsSend(x)},o.peerConnection.onnegotiationneeded=async function(){const d=await o.peerConnection.createOffer();o.isOffer=!0,await o.peerConnection.setLocalDescription(d);const x={Type:O.offer,Data:{RoomId:_.query.room,RecvId:i.get(e).remoteUser,Desc:d}};c.wsSend(x)},E.value.getTracks().forEach(d=>{o.peerConnection.addTrack(d,E.value)})}}async function Z(e,a){var d;const o={sdp:a.Desc.Sdp,type:a.Desc.Type};(d=e.peerConnection)==null||d.setRemoteDescription(o)}async function ee(){return navigator.mediaDevices.getUserMedia(p).then(e=>{E.value=e,T.value=document.createElement("video"),T.value.srcObject=E.value,T.value.classList.add("rounded-full","aspect-square","border-8","bg-black","border-slate-600"),T.value.autoplay=!0;const a=document.getElementById("LocalVideo");a==null||a.appendChild(T.value)}).catch(e=>{alert("Browser doesn't support or there is some errors."+e)})}async function ie(){var e;if(N.value=!N.value,N.value?F.value=es:F.value=ce,N.value)await ee(),s.value!=null?s.value.UserList.forEach(async a=>{a!=h.id&&await U(a)}):n.state.Room.UserList.forEach(async a=>{a!=h.id&&await U(a)});else{(e=E.value)==null||e.getTracks().forEach(o=>{o.stop()});const a=document.getElementById("LocalVideo");a==null||a.removeChild(T.value)}}function te(e,a){e.close(),i.delete(a.LeaveUser)}function ae(){const e={Type:O.broadcastMessage,Data:{RoomId:_.query.room,Message:H.value}};c.wsSend(e),V.value.push({MessageSender:"me",Message:H.value}),V.value.length>=10&&V.value.splice(0,1),H.value=""}function re(e,a){var o=function(d){var x=new RegExp("(a=rtpmap:(\\d*) "+a+"/90000\\r\\n)"),k=d.match(x);if(k==null||k.length<=2)return d;var R=k[2],u=d.replace(x,""),j=new RegExp("(a=rtcp-fb:"+R+`.*\r
)`,"g");u=u.replace(j,"");var oe=new RegExp("(a=fmtp:"+R+`.*\r
)`,"g");u=u.replace(oe,"");var q=new RegExp("(a=fmtp:(\\d*) apt="+R+"\\r\\n)"),t=u.match(q),m="";if(t!=null&&t.length>=3){m=t[2],u=u.replace(q,"");var C=new RegExp("(a=rtpmap:"+m+`.*\r
)`,"g");u=u.replace(C,"")}var y=/(m=video.*\r\n)/,S=u.match(y);if(S!=null){for(var v=S[0].substring(0,S[0].length-2),I=v.split(" "),$=I[0],B=1;B<I.length;B++)I[B]==R||I[B]==m||($+=" "+I[B]);$+=`\r
`,u=u.replace(y,$)}return o(u)};return o(e)}function se(){le.push({name:"Lobby"})}return he(()=>{var e;Object.entries(r).forEach(([a,o])=>{var d;(d=n.state.socketInstance)==null||d.unSubscribe(a,o)}),i.forEach(a=>{a.close()}),(e=E.value)==null||e.getTracks().forEach(a=>{a.stop()}),i.clear()}),(e,a)=>(W(),z("div",ts,[l("div",as,[l("header",ss,[l("div",os,[l("div",ns,[is,l("p",rs,A(D(h).id),1),l("button",{onClick:ie,class:"bg-red-500 max-w-one-three hover:bg-red-700 focus:outline-none focus:ring focus:ring-red-300 sm:text-sm active:bg-red-700 p-2 rounded-full"},[l("img",{src:F.value,class:"cursor-pointer",alt:"userImage"},null,8,ls)])])]),l("div",ds,[l("div",null,[l("p",cs," Room:"+A(D(_).query.room),1)])]),l("div",{class:"max-w-one-three w-full flex justify-end items-center"},[l("button",{onClick:se,class:"bg-sky-500 hover:bg-sky-700 focus:outline-none focus:ring focus:ring-sky-300 active:bg-sky-700 px-5 py-2 text-xs leading-5 sm:text-base rounded-full font-semibold text-white"}," Home ")])])]),l("div",us,[l("div",ms,[ps,l("div",fs,[pe(D(Za),{active:L.value,"onUpdate:active":a[0]||(a[0]=o=>L.value=o),"can-cancel":!1,"is-full-page":!1},null,8,["active"])]),l("div",hs,[l("div",gs,[l("div",vs,[(W(!0),z(ue,null,ge(V.value,o=>(W(),z("div",bs,[l("p",null,[l("span",null,A(o.MessageSender)+": ",1),me(A(o.Message),1)])]))),256))]),ys,l("div",_s,[ve(l("input",{class:"max-w-one-two md:max-w-full rounded-full text-base px-2 my-1 mx-1","onUpdate:modelValue":a[1]||(a[1]=o=>H.value=o)},null,512),[[be,H.value]]),l("button",{onClick:ae,class:"bg-gray-500 hover:bg-gray-700 focus:outline-none focus:ring focus:ring-gray-300 active:bg-gray-700 px-3 py-2 leading-5 text-sm rounded-full font-semibold text-white"}," Send ")])])])])])]))}});export{Ss as default};
